<!DOCTYPE HTML>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>To panic! or Not To panic! - </title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <base href="">

        <link rel="stylesheet" href="book.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">

        <link rel="shortcut icon" href="favicon.png">

        <!-- Font Awesome -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">

        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme -->
        

        

        <!-- Fetch Clipboard.js from CDN but have a local fallback -->
        <script src="https://cdn.jsdelivr.net/clipboard.js/1.6.1/clipboard.min.js"></script>
        <script>
            if (typeof Clipboard == 'undefined') {
                document.write(unescape("%3Cscript src='clipboard.min.js'%3E%3C/script%3E"));
            }
        </script>

    </head>
    <body class="light">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { } 
            if (theme === null || theme === undefined) { theme = 'light'; }
            document.body.className = theme;
            document.querySelector('html').className = theme;
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            document.querySelector('html').classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <ol class="chapter"><li><a href="ch01-00-introduction.html"><strong aria-hidden="true">1.</strong> üáßüá∑ Introdu√ß√£o</a></li><li><ol class="section"><li><a href="ch01-01-installation.html"><strong aria-hidden="true">1.1.</strong> üáßüá∑ Instala√ß√£o</a></li><li><a href="ch01-02-hello-world.html"><strong aria-hidden="true">1.2.</strong> üáßüá∑ Ol√°, Mundo!</a></li></ol></li><li><a href="ch02-00-guessing-game-tutorial.html"><strong aria-hidden="true">2.</strong> üáßüá∑ Jogo de Adivinha√ß√£o</a></li><li><a href="ch03-00-common-programming-concepts.html"><strong aria-hidden="true">3.</strong> üáßüá∑ Conceitos Comuns de Programa√ß√£o</a></li><li><ol class="section"><li><a href="ch03-01-variables-and-mutability.html"><strong aria-hidden="true">3.1.</strong> üáßüá∑ Vari√°veis e Mutabilidade</a></li><li><a href="ch03-02-data-types.html"><strong aria-hidden="true">3.2.</strong> Data Types</a></li><li><a href="ch03-03-how-functions-work.html"><strong aria-hidden="true">3.3.</strong> How Functions Work</a></li><li><a href="ch03-04-comments.html"><strong aria-hidden="true">3.4.</strong> Comments</a></li><li><a href="ch03-05-control-flow.html"><strong aria-hidden="true">3.5.</strong> Control Flow</a></li></ol></li><li><a href="ch04-00-understanding-ownership.html"><strong aria-hidden="true">4.</strong> Understanding Ownership</a></li><li><ol class="section"><li><a href="ch04-01-what-is-ownership.html"><strong aria-hidden="true">4.1.</strong> What is Ownership?</a></li><li><a href="ch04-02-references-and-borrowing.html"><strong aria-hidden="true">4.2.</strong> References &amp; Borrowing</a></li><li><a href="ch04-03-slices.html"><strong aria-hidden="true">4.3.</strong> Slices</a></li></ol></li><li><a href="ch05-00-structs.html"><strong aria-hidden="true">5.</strong> üáßüá∑ Structs</a></li><li><ol class="section"><li><a href="ch05-01-method-syntax.html"><strong aria-hidden="true">5.1.</strong> Method Syntax</a></li></ol></li><li><a href="ch06-00-enums.html"><strong aria-hidden="true">6.</strong> üáßüá∑ Enums e Casamento de Padr√µes</a></li><li><ol class="section"><li><a href="ch06-01-defining-an-enum.html"><strong aria-hidden="true">6.1.</strong> üáßüá∑ Definindo uma Enum</a></li><li><a href="ch06-02-match.html"><strong aria-hidden="true">6.2.</strong> üáßüá∑ Operador match</a></li><li><a href="ch06-03-if-let.html"><strong aria-hidden="true">6.3.</strong> üáßüá∑ Controle de Fluxo Conciso com if let</a></li></ol></li><li><a href="ch07-00-modules.html"><strong aria-hidden="true">7.</strong> üáßüá∑ M√≥dulos</a></li><li><ol class="section"><li><a href="ch07-01-mod-and-the-filesystem.html"><strong aria-hidden="true">7.1.</strong> üáßüá∑ mod e o Sistema de Arquivos</a></li><li><a href="ch07-02-controlling-visibility-with-pub.html"><strong aria-hidden="true">7.2.</strong> üáßüá∑ Controlando a Visibilidade com pub</a></li><li><a href="ch07-03-importing-names-with-use.html"><strong aria-hidden="true">7.3.</strong> üáßüá∑ Importando nomes com use</a></li></ol></li><li><a href="ch08-00-fundamental-collections.html"><strong aria-hidden="true">8.</strong> Fundamental Collections</a></li><li><ol class="section"><li><a href="ch08-01-vectors.html"><strong aria-hidden="true">8.1.</strong> üáßüá∑ Vetores</a></li><li><a href="ch08-02-strings.html"><strong aria-hidden="true">8.2.</strong> üáßüá∑ Strings</a></li><li><a href="ch08-03-hash-maps.html"><strong aria-hidden="true">8.3.</strong> üáßüá∑ Hash Maps</a></li></ol></li><li><a href="ch09-00-error-handling.html"><strong aria-hidden="true">9.</strong> Error Handling</a></li><li><ol class="section"><li><a href="ch09-01-unrecoverable-errors-with-panic.html"><strong aria-hidden="true">9.1.</strong> Unrecoverable Errors with panic!</a></li><li><a href="ch09-02-recoverable-errors-with-result.html"><strong aria-hidden="true">9.2.</strong> Recoverable Errors with Result</a></li><li><a href="ch09-03-to-panic-or-not-to-panic.html" class="active"><strong aria-hidden="true">9.3.</strong> To panic! or Not To panic!</a></li></ol></li><li><a href="ch10-00-generics.html"><strong aria-hidden="true">10.</strong> Generics</a></li><li><ol class="section"><li><a href="ch10-01-syntax.html"><strong aria-hidden="true">10.1.</strong> Syntax</a></li><li><a href="ch10-02-traits.html"><strong aria-hidden="true">10.2.</strong> Traits</a></li><li><a href="ch10-03-lifetime-syntax.html"><strong aria-hidden="true">10.3.</strong> Lifetime syntax</a></li></ol></li><li><a href="ch11-00-testing.html"><strong aria-hidden="true">11.</strong> Testing</a></li><li><ol class="section"><li><a href="ch11-01-writing-tests.html"><strong aria-hidden="true">11.1.</strong> Writing tests</a></li><li><a href="ch11-02-running-tests.html"><strong aria-hidden="true">11.2.</strong> Running tests</a></li><li><a href="ch11-03-test-organization.html"><strong aria-hidden="true">11.3.</strong> Test Organization</a></li></ol></li><li><a href="ch12-00-an-io-project.html"><strong aria-hidden="true">12.</strong> An I/O Project</a></li><li><ol class="section"><li><a href="ch12-01-accepting-command-line-arguments.html"><strong aria-hidden="true">12.1.</strong> Accepting Command Line Arguments</a></li><li><a href="ch12-02-reading-a-file.html"><strong aria-hidden="true">12.2.</strong> Reading a File</a></li><li><a href="ch12-03-improving-error-handling-and-modularity.html"><strong aria-hidden="true">12.3.</strong> Improving Error Handling and Modularity</a></li><li><a href="ch12-04-testing-the-librarys-functionality.html"><strong aria-hidden="true">12.4.</strong> Testing the Library's Functionality</a></li><li><a href="ch12-05-working-with-environment-variables.html"><strong aria-hidden="true">12.5.</strong> Working with Environment Variables</a></li><li><a href="ch12-06-writing-to-stderr-instead-of-stdout.html"><strong aria-hidden="true">12.6.</strong> Writing to stderr instead of stdout</a></li></ol></li><li><a href="ch13-00-functional-features.html"><strong aria-hidden="true">13.</strong> Functional Language Features in Rust</a></li><li><ol class="section"><li><a href="ch13-01-closures.html"><strong aria-hidden="true">13.1.</strong> Closures</a></li><li><a href="ch13-02-iterators.html"><strong aria-hidden="true">13.2.</strong> Iterators</a></li><li><a href="ch13-03-improving-our-io-project.html"><strong aria-hidden="true">13.3.</strong> Improving our I/O Project</a></li><li><a href="ch13-04-performance.html"><strong aria-hidden="true">13.4.</strong> Performance</a></li></ol></li><li><a href="ch14-00-more-about-cargo.html"><strong aria-hidden="true">14.</strong> More about Cargo and Crates.io</a></li><li><ol class="section"><li><a href="ch14-01-release-profiles.html"><strong aria-hidden="true">14.1.</strong> Release Profiles</a></li><li><a href="ch14-02-publishing-to-crates-io.html"><strong aria-hidden="true">14.2.</strong> Publishing a Crate to Crates.io</a></li><li><a href="ch14-03-cargo-workspaces.html"><strong aria-hidden="true">14.3.</strong> Cargo Workspaces</a></li><li><a href="ch14-04-installing-binaries.html"><strong aria-hidden="true">14.4.</strong> Installing Binaries from Crates.io with cargo install</a></li><li><a href="ch14-05-extending-cargo.html"><strong aria-hidden="true">14.5.</strong> Extending Cargo with Custom Commands</a></li></ol></li><li><a href="ch15-00-smart-pointers.html"><strong aria-hidden="true">15.</strong> Smart Pointers</a></li><li><a href="ch16-00-concurrency.html"><strong aria-hidden="true">16.</strong> Concurrency</a></li><li><a href="ch17-00-oop.html"><strong aria-hidden="true">17.</strong> Is Rust OOP?</a></li><li><a href="ch18-00-patterns.html"><strong aria-hidden="true">18.</strong> Patterns</a></li><li><a href="ch19-00-more-lifetimes.html"><strong aria-hidden="true">19.</strong> More Lifetimes</a></li><li><a href="ch20-00-advanced-types.html"><strong aria-hidden="true">20.</strong> Advanced Type System Features</a></li><li><a href="appendix-00.html"><strong aria-hidden="true">21.</strong> Appendix</a></li><li><ol class="section"><li><a href="appendix-01-keywords.html"><strong aria-hidden="true">21.1.</strong> Keywords</a></li><li><a href="appendix-02-operators.html"><strong aria-hidden="true">21.2.</strong> Operators</a></li><li><a href="appendix-03-derivable-traits.html"><strong aria-hidden="true">21.3.</strong> Derivable Traits</a></li><li><a href="appendix-04-nightly-rust.html"><strong aria-hidden="true">21.4.</strong> Nightly Rust</a></li><li><a href="appendix-05-macros.html"><strong aria-hidden="true">21.5.</strong> Macros</a></li></ol></li></ol>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar" class="menu-bar">
                    <div id="menu-bar-sticky-container">
                        <div class="left-buttons">
                            <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                                <i class="fa fa-bars"></i>
                            </button>
                            <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                                <i class="fa fa-paint-brush"></i>
                            </button>
                            <ul id="theme-list" class="theme-popup" aria-label="submenu">
                                <li><button class="theme" id="light">Light <span class="default">(default)</span></button></li>
                                <li><button class="theme" id="rust">Rust</button></li>
                                <li><button class="theme" id="coal">Coal</button></li>
                                <li><button class="theme" id="navy">Navy</button></li>
                                <li><button class="theme" id="ayu">Ayu</button></li>
                            </ul>
                        </div>

                        <h1 class="menu-title"></h1>

                        <div class="right-buttons">
                            <a href="print.html" title="Print this book" aria-label="Print this book">
                                <i id="print-button" class="fa fa-print"></i>
                            </a>
                        </div>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <a class="header" href="ch09-03-to-panic-or-not-to-panic.html#entrar-em-panic-ou-n√£o-entrar-em-panic" id="entrar-em-panic-ou-n√£o-entrar-em-panic"><h2>Entrar em <code>panic!</code> ou N√£o Entrar em <code>panic!</code></h2></a>
<p>Ent√£o como voc√™ decide quando entrar em <code>panic!</code> e quando voc√™ deveria retornar
um <code>Result</code>? Quando o c√≥digo entra em p√¢nico, n√£o h√° maneira de se recuperar. Voc√™
poderia chamar <code>panic!</code> para qualquer situa√ß√£o de erro, tendo uma maneira de se recuperar
ou n√£o, mas ent√£o voc√™ estaria decidindo no lugar do c√≥digo que chama seu c√≥digo
que a situa√ß√£o √© irrecuper√°vel. Quando voc√™ decide retornar um valor de <code>Result</code>,
voc√™ lhe d√° op√ß√µes em vez de tomar a decis√£o por ele. O c√≥digo
que chama seu c√≥digo pode tentar se recuperar de uma maneira que √© apropriada para
a situa√ß√£o, ou ele pode decidir que um valor de <code>Err</code> nesse caso √© irrecuper√°vel,
chamando <code>panic!</code> e transformando seu erro recuper√°vel em um irrecuper√°vel.
Portanto, retornar <code>Result</code> √© uma boa escolha padr√£o quando voc√™ est√° definindo
uma fun√ß√£o que pode falhar.</p>
<p>Em algumas situa√ß√µes √© mais apropriado escrever c√≥digo que entra em p√¢nico em vez
de retornar um <code>Result</code>, mas eles s√£o menos comuns. Vamos explorar porque √© apropriado
entrar em p√¢nico em alguns exemplos, prot√≥tipos de c√≥digo e testes; depois situa√ß√µes
em que voc√™ como humano pode saber que um m√©todo n√£o vai falhar, mas que o compilador n√£o
tem como saber; e concluir com algumas diretrizes sobre como decidir entrar ou
n√£o em p√¢nico em c√≥digo de biblioteca.</p>
<a class="header" href="ch09-03-to-panic-or-not-to-panic.html#exemplos-prot√≥tipos-e-testes-s√£o-todos-lugares-em-que-√â-perfeitamente-ok-entrar-em-p√¢nico" id="exemplos-prot√≥tipos-e-testes-s√£o-todos-lugares-em-que-√â-perfeitamente-ok-entrar-em-p√¢nico"><h3>Exemplos, Prot√≥tipos, e Testes S√£o Todos Lugares em que √â Perfeitamente Ok Entrar em P√¢nico</h3></a>
<p>Quando voc√™ est√° escrevendo um exemplo para ilustrar algum conceito, ter c√≥digo
de tratamento de erro robusto junto do exemplo pode torn√°-lo menos claro. Em exemplos,
√© compreens√≠vel que uma chamada a um m√©todo como <code>unwrap</code> que poderia chamar <code>panic!</code>
apenas substitua a maneira como voc√™ trataria erros na sua aplica√ß√£o,
que pode ser diferente baseado no que o resto do seu c√≥digo est√° fazendo.</p>
<p>De forma semelhante, os m√©todos <code>unwrap</code> e <code>expect</code> s√£o bem √∫teis ao fazer
prot√≥tipos, antes de voc√™ estar pronto para decidir como tratar erros. Eles deixam
marcadores claros no seu c√≥digo para quando voc√™ estiver pronto para tornar
seu programa mais robusto.</p>
<p>Se uma chamada de m√©todo falha em um teste, queremos que o teste inteiro falhe,
mesmo se esse m√©todo n√£o √© a funcionalidade sendo testada. Como <code>panic!</code> √© o modo
que um teste √© marcado como falha, chamar <code>unwrap</code> ou <code>expect</code> √© exatamente o que
deveria acontecer.</p>
<a class="header" href="ch09-03-to-panic-or-not-to-panic.html#casos-em-que-voc√™-tem-mais-informa√ß√£o-que-o-compilador" id="casos-em-que-voc√™-tem-mais-informa√ß√£o-que-o-compilador"><h3>Casos em que Voc√™ Tem Mais Informa√ß√£o Que o Compilador</h3></a>
<p>Seria tamb√©m apropriado chamar <code>unwrap</code> quando voc√™ tem outra l√≥gica que
assegura que o <code>Result</code> vai ter um valor <code>Ok</code>, mas essa l√≥gica n√£o √© algo
que o compilador entenda. Voc√™ ainda vai ter um valor de <code>Result</code> que precisa
lidar: seja qual for a opera√ß√£o que voc√™ est√° chamando, ela ainda tem uma possibilidade
de falhar em geral, mesmo que seja logicamente imposs√≠vel que isso ocorra nessa
situa√ß√£o particular. Se voc√™ consegue assegurar ao inspecionar manualmente o c√≥digo que
voc√™ nunca tera uma variante <code>Err</code>, √© perfeitamente aceit√°vel chamar <code>unwrap</code>.
Aqui temos um exemplo:</p>
<pre><pre class="playpen"><code class="language-rust">
# #![allow(unused_variables)]
#fn main() {
use std::net::IpAddr;

let home = &quot;127.0.0.1&quot;.parse::&lt;IpAddr&gt;().unwrap();
#}</code></pre></pre>
<p>N√≥s estamos criando uma inst√¢ncia <code>IpAddr</code> ao analisar uma string <em>hardcoded</em>. N√≥s
podemos ver que <code>127.0.0.1</code> √© um endere√ßo de IP v√°lido, ent√£o √© aceit√°vel usar
<code>unwrap</code> aqui. No entanto, ter uma string v√°lida <em>hardcoded</em> n√£o muda o tipo retornado
pelo m√©todo <code>parse</code>: ainda teremos um valor de <code>Result</code>, e o compilador ainda
vai nos fazer tratar o <code>Result</code> como se a variante <code>Err</code> fosse uma
possibilidade, porque o compilador n√£o √© inteligente o bastante para ver que essa string
√© sempre um endere√ßo IP v√°lido. Se a string de endere√ßo IP viesse de um usu√°rio ao inv√©s
de ser <em>hardcoded</em> no programa, e portanto, de fato tivesse uma possibilidade de falha, n√≥s
definitivamente ir√≠amos querer tratar o <code>Result</code> de uma forma mais robusta.</p>
<a class="header" href="ch09-03-to-panic-or-not-to-panic.html#diretrizes-para-tratamento-de-erro" id="diretrizes-para-tratamento-de-erro"><h3>Diretrizes para Tratamento de Erro</h3></a>
<p>√â aconselh√°vel fazer que seu c√≥digo entre em <code>panic!</code> quando √© poss√≠vel que
ele entre em um mau estado. Nesse contexto, mau estado √© quando
alguma hip√≥tese, garantia, contrato ou invariante foi quebrada, tal como
valores inv√°lidos, valores contradit√≥rios, ou valores faltando que s√£o passados
a seu c√≥digo - al√©m de um ou mais dos seguintes:</p>
<ul>
<li>O mau estado n√£o √© algo que √© <em>esperado</em> que aconte√ßa ocasionalmente.</li>
<li>Seu c√≥digo ap√≥s certo ponto precisa confiar que ele n√£o est√° nesse mau estado.</li>
<li>N√£o h√° uma forma boa de codificar essa informa√ß√£o nos tipos que voc√™ usa.</li>
</ul>
<p>Se algu√©m chama seu c√≥digo e passa valores que n√£o fazem sentido, a melhor escolha
talvez seja entrar em <code>panic!</code> e alertar a pessoa usando sua biblioteca do bug no
c√≥digo dela para que ela possa consert√°-la durante o desenvolvimento. Similarmente,
<code>panic!</code> √© em geral apropriado se voc√™ est√° chamando c√≥digo externo que est√° fora
do seu controle e ele retorna um estado inv√°lido que voc√™ n√£o tem como consertar.</p>
<p>Quando se chega a um mau estado, mas isso √© esperado que aconte√ßa n√£o importa
qu√£o bem voc√™ escreva seu c√≥digo, ainda √© mais apropriado retornar um <code>Result</code>
a fazer uma chamada a <code>panic!</code>. Um exemplo disso √© um <em>parser</em> recebendo dados
malformados ou uma requisi√ß√£o HTTP retornando um status que indique que voc√™ atingiu
um limite de taxa. Nesses casos, voc√™ deveria indicar que falha √© uma possibilidade
esperada ao retornar um <code>Result</code> para propagar esses estados ruins para cima,
de forma que o c√≥digo que chamou seu c√≥digo pode decidir como tratar o problema.
Entrar em <code>panic!</code> n√£o seria a melhor maneira de lidar com esses casos.</p>
<p>Quando seu c√≥digo realiza opera√ß√µes em valores, ele deveria verificar que os valores
s√£o v√°lidos primeiro, e entrar em <code>panic!</code> caso n√£o sejam. Isso √©
em boa parte por raz√µes de seguran√ßa: tentar operar em dados inv√°lidos pode expor seu
c√≥digo a vulnerabilidades. Essa √© a principal raz√£o para a biblioteca padr√£o entrar em
<code>panic!</code> se voc√™ tentar um acesso de mem√≥ria fora dos limites: tentar acessar mem√≥ria
que n√£o pertence √† estrutura de dados atual √© um problema de seguran√ßa comum. Fun√ß√µes
frequentemente tem <em>contratos</em>: seu comportamento somente √© garantido se os inputs cumprem
requerimentos espec√≠ficos. Entrar em p√¢nico quando o contrato √© violado faz sentido
porque uma viola√ß√£o de contrato sempre indica um bug da parte do chamador, e n√£o √© o tipo
de erro que voc√™ quer que seja tratado explicitamente. De fato,
n√£o h√° nenhuma maneira razo√°vel para o c√≥digo chamador se recuperar: os <em>programadores</em>
que precisam consertar o c√≥digo. Contratos para uma fun√ß√£o, especialmente quando uma
viola√ß√£o leva a p√¢nico, devem ser explicados na documenta√ß√£o da API da fun√ß√£o.</p>
<p>No entanto, ter v√°rias checagens de erro em todas suas fun√ß√µes pode ser verboso
e irritante. Felizmente, voc√™ pode usar o sistema de tipos do Rust (e portanto a
checagem que o compilador faz) para fazer v√°rias dessas checagens para voc√™. Se
sua fun√ß√£o tem um tipo particular como par√¢metro, voc√™ pode continuar com a l√≥gica
do seu c√≥digo sabendo que o compilador j√° assegurou que voc√™ tem um valor v√°lido.
Por exemplo, se voc√™ tem um tipo em vez de uma <code>Option</code>, seu programa espera
ter <em>algo</em> ao inv√©s de <em>nada</em>. Seu c√≥digo n√£o precisa tratar dois casos para
as variantes <code>Some</code> e <code>None</code>: ele vai somente ter um caso para definitivamente ter
um valor. Um c√≥digo que tente passar nada para sua fun√ß√£o n√£o vai nem compilar,
ent√£o sua fun√ß√£o n√£o precisa checar esse caso em tempo de execu√ß√£o. Outro exemplo √© usar
um tipo de inteiro sem sinal como <code>u32</code>, que assegura que o par√¢metro nunca √©
negativo.</p>
<a class="header" href="ch09-03-to-panic-or-not-to-panic.html#criando-tipos-customizados-para-valida√ß√£o" id="criando-tipos-customizados-para-valida√ß√£o"><h3>Criando Tipos Customizados para Valida√ß√£o</h3></a>
<p>Vamos dar um passo al√©m na ideia de usar o sistema de tipos de Rust para assegurar que temos
um valor v√°lido e ver como criar um tipo customizado para valida√ß√£o.
Lembre do jogo de adivinha√ß√£o no Cap√≠tulo 2 onde nosso c√≥digo pedia ao usu√°rio
para adivinhar um n√∫mero entre 1 e 100. N√≥s nunca validamos que o chute do usu√°rio
fosse entre esses n√∫meros antes de compar√°-lo com o n√∫mero secreto; n√≥s somente
validamos que o chute era positivo. Nesse caso, as consequ√™ncias n√£o foram t√£o
dr√°sticas: nosso output de &quot;Muito alto&quot; ou &quot;Muito baixo&quot; ainda estariam corretos. Seria
uma melhoria √∫til guiar o usu√°rio para chutes v√°lidos, e ter um comportamento distinto
quando um usu√°rio chuta um n√∫mero fora do limite e quando um usu√°rio digita letras, por exemplo.</p>
<p>Uma maneira de fazer isso seria interpretar o chute como um <code>i32</code> em vez de
somente um <code>u32</code> para permitir n√∫meros potenciamente negativos, e ent√£o adicionar
uma checagem se o n√∫mero est√° dentro dos limites, conforme a seguir:</p>
<pre><code class="language-rust ignore">loop {
    // snip

    let palpite: i32 = match palpite.trim().parse() {
        Ok(num) =&gt; num,
        Err(_) =&gt; continue,
    };

    if palpite &lt; 1 || palpite &gt; 100 {
        println!(&quot;O n√∫mero secreto vai estar entre 1 e 100.&quot;);
        continue;
    }

    match palpite.cmp(&amp;numero_secreto) {
    // snip
}
</code></pre>
<p>A express√£o <code>if</code> checa se nosso valor est√° fora dos limites, informa o usu√°rio
sobre o problema, e chama <code>continue</code> para come√ßar a pr√≥xima itera√ß√£o do loop
e pedir por outro chute. Depois da express√£o <code>if</code> podemos proceder com as
compara√ß√µes entre <code>palpite</code> e o n√∫mero secreto sabendo que <code>palpite</code> est√°
entre 1 e 100.</p>
<p>No entanto, essa n√£o √© a solu√ß√£o ideal: se fosse absolutamente cr√≠tico que o
programa somente operasse em valores entre 1 e 100, e ele tivesse v√°rias fun√ß√µes
com esse requisito, seria tedioso (e potencialmente impactante na performance)
ter uma checagem dessa em cada fun√ß√£o.</p>
<p>Em vez disso, podemos fazer um novo tipo e colocar as valida√ß√µes em uma fun√ß√£o
para criar uma inst√¢ncia do tipo em vez de repetir as valida√ß√µes em todo lugar.
Dessa maneira, √© seguro para fun√ß√µes usarem o novo tipo nas suas assinaturas e
confidentemente usar os valores que recebem. A Listagem 9-9  mostra uma maneira de
definir um tipo <code>Palpite</code> que vai somente criar uma inst√¢ncia de <code>Palpite</code> se a fun√ß√£o
<code>new</code> receber um valor entre 1 e 100:</p>
<pre><pre class="playpen"><code class="language-rust">
# #![allow(unused_variables)]
#fn main() {
pub struct Palpite {
    valor: u32,
}

impl Palpite {
    pub fn new(valor: u32) -&gt; Palpite {
        if valor &lt; 1 || valor &gt; 100 {
            panic!(&quot;Valor de chute deve ser entre 1 e 100, recebi {}.&quot;, valor);
        }

        Palpite {
            valor
        }
    }

    pub fn valor(&amp;self) -&gt; u32 {
        self.valor
    }
}
#}</code></pre></pre>
<p><span class="caption">Listagem 9-9: Um tipo <code>Palpite</code> que somente funciona com valores
entre 1 e 100.</span></p>
<p>Primeiro, definimos uma struct chamada <code>Palpite</code> que tem um campo chamado <code>valor</code>
que guarda um <code>u32</code>. Isso √© onde o n√∫mero vai ser guardado.</p>
<p>Ent√£o n√≥s implementamos uma fun√ß√£o associada chamada <code>new</code> em <code>Palpite</code> que cria
inst√¢ncias de valores <code>Palpite</code>. A fun√ß√£o <code>new</code> √© definida a ter um par√¢metro
chamado <code>valor</code> de tipo <code>u32</code> e retornar um <code>Palpite</code>. O c√≥digo no corpo da fun√ß√£o
<code>new</code> testa para ter certeza que <code>valor</code> est√° entre 1 e 100. Se <code>valor</code> n√£o passa
nesse teste, fazemos uma chamada a <code>panic!</code>, que vai alertar ao programador que
est√° escrevendo o c√≥digo chamando a fun√ß√£o que ele tem um bug que precisa ser
corrigido, porque criar um <code>Palpite</code> com um <code>valor</code> fora desses limites violaria
o contrato em que <code>Palpite::new</code> se baseia. As condi√ß√µes em que <code>Palpite::new</code> pode
entrar em p√¢nico devem ser discutidas na sua documenta√ß√£o da API voltada ao p√∫blico;
no Cap√≠tulo 14 n√≥s cobriremos conven√ß√µes de documenta√ß√£o indicando a possibilidade de um <code>panic!</code>
na documenta√ß√£o de API. Se <code>valor</code> de fato passa no
teste, criamos um novo <code>Palpite</code> com o campo <code>valor</code> preenchido com o par√¢metro
<code>valor</code> e retornamos o <code>Palpite</code>.</p>
<p>Em seguida, implementamos um m√©todo chamado <code>valor</code> que pega <code>self</code> emprestado, n√£o
tem nenhum outro par√¢metro, e retorna um <code>u32</code>. Esse √© o tipo de m√©todo √†s vezes
chamado de <em>getter</em>, pois seu prop√≥sito √© pegar um dado de um dos campos e o retornar.
Esse m√©todo p√∫blico √© necess√°rio porque o campo <code>valor</code> da struct <code>Palpite</code> √© privado.
√â importante que o campo <code>valor</code> seja privado para que c√≥digo usando a struct <code>Palpite</code>
n√£o tenha permiss√£o de definir o valor de <code>valor</code> diretamente: c√≥digo de fora do m√≥dulo
<em>deve</em> usar a fun√ß√£o <code>Palpite::new</code> para criar uma inst√¢ncia de <code>Palpite</code>, o que certifica
que n√£o h√° maneira de um <code>Palpite</code> ter um <code>valor</code> que n√£o foi checado pelas condi√ß√µes
definidas na fun√ß√£o <code>Palpite::new</code>.</p>
<p>Uma fun√ß√£o que tem um par√¢metro ou retorna somente n√∫meros entre 1 e 100 pode
ent√£o declarar na sua assinatura que ela recebe ou retorna um <code>Palpite</code> em vez
de um <code>u32</code> e n√£o precisaria fazer nenhuma checagem adicional no seu corpo.</p>
<a class="header" href="ch09-03-to-panic-or-not-to-panic.html#resumo" id="resumo"><h2>Resumo</h2></a>
<p>As ferramentas de tratamento de erros de Rust s√£o feitas para te ajudar a escrever
c√≥digo mais robusto. A macro <code>panic!</code> sinaliza que seu programa est√° num estado que
n√£o consegue lidar e deixa voc√™ parar o processo ao inv√©s de tentar prosseguir com
valores inv√°lidos ou incorretos. O enum <code>Result</code> usa o sistema de tipos de Rust para
indicar que opera√ß√µes podem falhar de uma maneira que seu c√≥digo pode se recuperar.
Voc√™ pode usar <code>Result</code> para dizer ao c√≥digo que chama seu c√≥digo que ele precisa
tratar potenciais sucessos ou falhas tamb√©m. Usar <code>panic!</code> e <code>Result</code> nas situa√ß√µes
apropriadas far√° seu c√≥digo mais confi√°vel em face aos problemas inevit√°veis.</p>
<p>Agora que voc√™ viu as maneiras √∫teis em que a biblioteca padr√£o usa gen√©ricos com
os enums <code>Option</code> e <code>Result</code>, n√≥s falaremos como gen√©ricos funcionam e como voc√™
pode us√°-los em seu c√≥digo no pr√≥ximo cap√≠tulo.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="ch09-02-recoverable-errors-with-result.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="ch10-00-generics.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a href="ch09-02-recoverable-errors-with-result.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a href="ch10-00-generics.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>


        <!-- Local fallback for Font Awesome -->
        <script>
            if (getComputedStyle(document.querySelector(".fa")).fontFamily !== "FontAwesome") {
                var link = document.createElement('link');
                link.rel = 'stylesheet';
                link.type = 'text/css';
                link.href = '_FontAwesome/css/font-awesome.css';
                document.head.insertBefore(link, document.head.firstChild)
            }
        </script>

        

        

        

        

        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS script -->
        

    </body>
</html>
